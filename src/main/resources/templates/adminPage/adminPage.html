<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorator="fragments/adminPage_layout">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<!-- 시큐리티 + 에이젝스 에러 방지 설정 -->

<meta id="_csrf" name="_csrf" th:content="${_csrf.token}" />
<!-- default header name is X-CSRF-TOKEN -->
<meta id="_csrf_header" name="_csrf_header"
	th:content="${_csrf.headerName}" />
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script th:inline="javascript">
<!-- 시큐리티 + 에이젝스 에러 방지 설정222 -->

var token = $("meta[name='_csrf']").attr("content");
var header = $("meta[name='_csrf_header']").attr("content");
$(function() {
	$(document).ajaxSend(function(e, xhr, options) {
		xhr.setRequestHeader(header, token);
	});
	
	var auth = [[${auth}]];
	
	if(auth!==""){
	$("#"+auth).attr("selected","selected");
	}
});


var id = "";
var check = "";

function changeAdmin(){
	
	var name = event.srcElement.id; /* 클릭한 태그의 id를 가져옴 */
	id = event.srcElement.value;
	$("#modalName").text(name+'님을 관리자로 임명하시겠습니까?');
	$("#confirmModal").modal();
}

function changeUser(){
	check = "음후히히";
	var name = event.srcElement.id; /* 클릭한 태그의 id를 가져옴 */
	id = event.srcElement.value;
	$("#modalName").text(name+'님을 일반회원으로 강등하시겠습니까?');
	$("#confirmModal").modal();
}

function frmSubmit(){
	
	$("#id").val(id);
	
	if(check==""){
	$("#frm").attr("action", "/adminPage/changeAdmin").submit();
	}else{
		$("#frm").attr("action", "/adminPage/changeUser").submit();
		
	}
	
	
	
}

function authSelect(auth){
	window.location.href="/adminPage/adminPage?auth="+auth;

}
</script>
<style>
.modal-content{
    width: max-content;
}
p{
    font-size: 20px;
        width: 413px;
}
</style>
</head>
<body>
<div layout:fragment="adminPage_content">

<select class="selectpicker" onchange="authSelect(this.value)">
	<option value=''>전체보기</option>
  <option value='user' id="user">USER</option>
  <option value='host' id="host">HOST</option>
  <option value='admin' id="admin">ADMIN</option>
</select>

<table border="2">
			<tr>
				<th>회원코드</th>
				<th>이름</th>
				<th>이메일</th>
				<th>권한</th>
				<th></th>
			</tr>
			<tr th:each="list : ${list}">
				<td th:text="${list.memberCode}"></td>
				<td th:text="${list.memberName}"></td>
				<td th:text="${list.id}"></td>
				<td th:text="${list.authority}"></td>
				<td>
				<button type="button" th:id="${list.memberName}" th:value="${list.id}" 
				th:if="${list.authority.equals('USER')}" onclick="changeAdmin()">관리자임명</button>
				<button type="button" th:id="${list.memberName}" th:value="${list.id}" 
				th:if="${list.authority.equals('ADMIN')}" onclick="changeUser()">강등</button>
				</td>
			</tr>
				</table>
				 <!-- 게시판 하단의 페이징 버튼 -->
            <div class="box-footer clearfix">
              <ul class="pagination pagination-sm no-margin pull-right">
              
              <li th:if="${pageMaker.prev} == true">
              	<a th:href="@{/adminPage/memberList(page=${pageMaker.startPage}-1,perPageNum=${pageMaker.cri.perPageNum})}">&laquo;</a>
              </li>
              
              <li th:each="idx,iterStat : ${#numbers.sequence(pageMaker.startPage,pageMaker.endPage)}"  th:classappend="${pageMaker.cri.page} == ${idx} ? active : null">
                <a th:href="@{/adminPage/memberList(page=${idx},perPageNum=${pageMaker.cri.perPageNum})}" th:text="${idx}"></a>
              </li>
                
              <li th:if="${pageMaker.next} == true and ${pageMaker.endPage > 0}">
              	<a th:href="@{/adminPage/memberList(page=${pageMaker.endPage}+1,perPageNum=${pageMaker.cri.perPageNum})}">&raquo;</a>
              </li>
              
              </ul>
              
            </div>
				<form id="frm">
				<input type="hidden" id="id" name="id">
				</form>
				
		
				
<!--Modal: confirmModal-->
<div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-sm modal-notify modal-danger" role="document">
    <!--Content-->
    <div class="modal-content text-center">
      <!--Header-->
      <div class="modal-header d-flex justify-content-center">
        <br/><br/><p id="modalName" class="heading"></p>
      </div>

      <!--Body-->
      <div class="modal-body">

 <a href="#" class="btn btn-primary btn-lg" onclick="frmSubmit()">확인</a>
        <a href="#" class="btn btn-primary btn-lg" data-dismiss="modal">취소</a>
        
      </div>
<br/>
      <!--Footer-->
      <div class="modal-footer flex-center">
       
      </div>
    </div>
    <!--/.Content-->
  </div>
</div>
<!--Modal: confirmModal-->

				
			</div>	
</body>
</html>