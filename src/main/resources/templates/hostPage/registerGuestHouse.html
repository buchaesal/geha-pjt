<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="fragments/hostPage_layout">

   <head>
   		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

      	<title>게스트하우스 등록</title>
      	<style>
         .hostPage_label {
            padding: 18px 15px;	
            font-size: 17px;
         }
         
         .hostPage_label>p {
         	margin-top: 5px;
         }
         
         input, textarea {padding: 0 15px;}
         
         th, td {line-height: 20px;}
         
         th {width: 250px; text-align: center;}
         
         td {
         	width: 500px; 
         	padding: 20px 30px;
         }
         
         .imgs_wrap {
            width: 600px;
            margin-top: 20px;	
         }
         
         .imgs_wrap img {
            max-width: 170px;
            margin: 3px;	
         }
         
         /* The Modal (background) */
         .modal {
               display: none; /* Hidden by default */
               position: fixed; /* Stay in place */
               z-index: 1; /* Sit on top */
               left: 0;
               top: 0;
               width: 100%; /* Full width */
               height: 100%; /* Full height */
               overflow: auto; /* Enable scroll if needed */
               background-color: rgb(0,0,0); /* Fallback color */
               background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
               text-align: center;
           }
       
           /* Modal Content/Box */
           .modal-content {
               background-color: #fefefe;
               margin: 15% auto; /* 15% from the top a nd centered */
               padding: 20px;
               border: 3px solid #e8c44b;
               width: 30%; /* Could be more or less, depending on screen size */                          
           }
           
           .modal-content>p {
           		font-size: 20px;
           		margin: 10px 0 30px 0;
           }
           
           .roomInfoDiv {
              display:  grid;
              background-color: #d3e4dd8c;
              margin: 10px 0;
              border: 7px solid #9ec7ae82;
			  border-radius: 30px;
			  padding: 15px;
           }
           
           tr.room_tr {
           		font-size: 14px;
           }
           
           tr.room_tr>tr {
           		padding-right: 10px; 
           }
           
           tr.room_tr>th>label>p {
           		font-size: 11px;
           		margin-top: 3px;
           }
           
           tr.room_tr>td {
           		padding: 13px 30px;
           		line-height: 27px;
           }
           
           input[type=file] {
           		display: initial;
           }
           
           .thumbnailImgSpan {
           		margin: 5px;
           }
           
           label>p {
           		font-size: 13px;
           }
           
           .checkboxLabel {
           		margin-right: 20px;
           		margin-top: 7px;
           }
           
           .room_imgs_wrap {
           		width: 400px;
           }
           
           .bank_label {
           		margin-right: 20px;
           }
           
           .room_tr {
           		padding: 0 0;
           }
           
           .room_tr>th>label {
           		width: 130px;
           }
           
           .bankTags {
           		line-height: 40px;
           }
           
           .guestHouseInfo>label {
           		margin: 20px 0 13px 10px;
           		font-size: 16px;
           }
           
           #roomInfoList>#roomBtnDiv {
           		text-align: center;
           }
           
           .btn-primary {
           		background-color: #2684d6;
           		border-color: #1c72bd;
           		width: 220px;
           }
           
           .btn-primary:hover {
           		background-color: #3071a9;
           		border-color: #285e8e;
           }
           
           .btn-submitLine {
           		text-align: center;
           }
           
           #cancelGuestHouseBtn {background-color: #cdae5cc2;}
           
           #cancelGuestHouseBtn:hover {background-color: #cdae5c;}
           
           #regiesterGuestHouseBtn {background-color:darkseagreen;}
           
           #regiesterGuestHouseBtn:hover {background-color: green;}
           
           .navbar-default {
			    background-color: transparent;
			    border-color: transparent;
			}
			
			.navbar-default .navbar-nav>li>a {
			    color: rgba(255, 255, 255, .7);
			}
			
			.navbar-default .nav>li>a:hover {
				color: #fff;
			}
			
			input[type=checkbox] {
				padding-left: 2px;
			}
			
			textarea::-webkit-input-placeholder {
			color: #808080ad !important;
			}
			 
			textarea:-moz-placeholder { /* Firefox 18- */
			color: #808080ad !important;  
			}
			 
			textarea::-moz-placeholder {  /* Firefox 19+ */
			color: #808080ad !important;  
			}
			 
			textarea:-ms-input-placeholder {  
			color: #808080ad !important;  
			}
			
			.btn-modal {
				background-color: #e8c44b8c;
				border-color: #e5be2342;
				width: 100px;
			}
			
			.btn-modal:hover {
				background-color: #e8c44b;
				border-color: #e8c44b;
			}
			
			.btn-modal:active:hover {
				background-color: #e1b930;
				border-color: #e1b930;
			}
			
			.guestHouse_table {
				width: 900px;
			}
			
			.hostPage_a:hover .hostPage_a:focus {
				text-decoration: none;
				color: #353232;
			}
			
			.rgs_btn-default {
				color: #333;
				background-color : #fff;
				border : 1px solid #ccc;
			}
			
			.rgs_btn-default:hover {
				color : #333;
				background-color : #e6e6e6;
				border : 1px solid #adadad;
			}
			
			.btn {
				border-radius : 4px;
				padding: 6px 12px;
			}
      </style>
   		<script type="text/javascript" src="/smarteditor/js/service/HuskyEZCreator.js" charset="utf-8"></script>
   </head>
   <body>
      <div layout:fragment="hostPage_content">
         <form id="registerGuestHouseForm" class="form-inline" th:action="@{registerGuestHouseComplete}" method="POST" enctype="multipart/form-data">
            <h2>내 게스트하우스 등록하기</h2>
            <input type="hidden" name="memberCode" th:value="${memberCode}">
            <table class="guestHouse_table">
            	<tr>
            		<th><label class="hostPage_label">게스트하우스 사진<br>(최대 10장) <p>메인이미지를 선택해주세요.</p></label></th>
            		<td>
            			<div>
			                <input type="file" id="input_imgs" name="files" multiple>
			                <input type="button" class="btn rgs_btn-default" value="파일삭제" onclick="deleteImgs(this)">
		            	</div>
		            	<div class="imgs_wrap" name="guestHouseImg"></div>
		            	<input type="hidden" name="guestHouse_imglength">
            		</td>
            	</tr>
               <tr>
                  <th><label class="hostPage_label">게스트하우스 이름<br>(상호명)</label></th>
                  <td><input type="text" name="guestHouseName" class="form-control" size="25" style="font-size: 23px; height: 45px;"></td>
               </tr>
               <tr>
                  <th><label class="hostPage_label">태그<br>(복수 선택 가능)</label></th>
                  <td>
                     <label class="checkboxLabel"><input type="checkbox" id="tag" name="gourmet" value="1">#맛집</label>
                     <label class="checkboxLabel"><input type="checkbox" id="tag" name="trip" value="1">#관광</label>
                     <label class="checkboxLabel"><input type="checkbox" id="tag" name="shopping" value="1">#쇼핑</label>
                     <label class="checkboxLabel"><input type="checkbox" id="tag" name="businessTrip" value="1">#출장</label>
                  </td>
               </tr>
               <tr>
                  <th><label class="hostPage_label">설명</label></th>
                  <td><textarea id="guestHouseInfo" name="guestHouseInfo" class="form-control col-sm-5" rows="15" cols="63" maxlength="500" placeholder="예) 
서울 모모게스트하우스를 찾아 주셔서 감사합니다.
테헤란로 쇼핑과 관광의 중심지에 위치하여, 관광 및 비지니스로 방문하신 여러분들의 편안한 숙소가 되어 드립니다.
지하철 2호선 역삼역, 9호선 언주역 인접, 또한 강남역과 가까운 서울 비지니스의 중심권에 위치합니다."></textarea></td>
               </tr>
               <tr>
                  <th><label class="hostPage_label">편의시설</label></th>
                  <td>
                     <label class="checkboxLabel"><input type="checkbox" name="facilityCode" value="1">세탁기</label>
                     <label class="checkboxLabel"><input type="checkbox" name="facilityCode" value="2">주차장</label>
                     <label class="checkboxLabel"><input type="checkbox" name="facilityCode" value="3">와이파이</label>
                     <label class="checkboxLabel"><input type="checkbox" name="facilityCode" value="4">에어컨</label>
                     <label class="checkboxLabel"><input type="checkbox" name="facilityCode" value="5">주방/식당</label>
                     <label class="checkboxLabel"><input type="checkbox" name="facilityCode" value="6">엘리베이터</label><br>
                     <label class="checkboxLabel"><input type="checkbox" name="facilityCode" value="7">냉장고</label>
                     <label class="checkboxLabel"><input type="checkbox" name="facilityCode" value="8">욕조</label>
                     <label class="checkboxLabel"><input type="checkbox" name="facilityCode" value="9">취사가능</label>
                     <label class="checkboxLabel"><input type="checkbox" name="facilityCode" value="10">전자레인지</label>
                     <label class="checkboxLabel"><input type="checkbox" name="facilityCode" value="11">드라이기</label>
                     <label class="checkboxLabel"><input type="checkbox" name="facilityCode" value="12">TV</label>
                  </td>
               </tr>
               <tr>
                  <th><label class="hostPage_label">방 등록</label></th>
                  <td id="roomInfoList">
                  	<div id="roomBtnDiv"><input id="addRoomInfoBtn" class="btn btn-primary" type="button" value="방 등록하기"></div>
                  </td>
               </tr>
               <tr>
                  <th><label class="hostPage_label">숙소 정보</label></th>
                  <td class="guestHouseInfo">
                     <label>숙소 이용 규칙</label><br>
                     <textarea id="rules" name="rules" class="form-control col-sm-5" rows="20" cols="63" maxlength="1000" placeholder="예)
[숙소 이용 규칙]
보안을 위하여 투숙객 본인외에 외부인 동반출입을 금지합니다
게스트하우스 전구역은 금연입니다
체크인이 오후 10시까지 안될 시 사전 연락주시길 바랍니다
애완동물은 동반할 수 없습니다
객실 내 식음을 금지합니다(주방에서 드실 수 있습니다)
타인에게 피해나 불쾌감을 주는 행위(심한 음주 등) 또는 게스트하우스 이용규정을 지키지 않을 경우 강제 퇴실 조치합니다
시설물을 파손하거나 침구류 훼손 및 오염(세탁불가능)시 전액 배상해야 합니다"></textarea><br><br>
                     <label style="margin-top: 20px;">주차장 정보</label><br>
                     <textarea id="parkingInfo" name="parkingInfo" class="form-control col-sm-5" rows="10" cols="63" maxlength="1000" placeholder="예)
건물 건너편 영등포 세무서 주차장
(무료 / 24시간 개방)"></textarea>
                  </td>
               </tr>
               <tr>
                  <th><label class="hostPage_label">주소</label></th>
                  <td style="line-height: 30px;">
                     <!-- 주소와 우편번호를 입력할 <input>들을 생성하고 적당한 name과 class를 부여한다 -->
					<input type="button" id="postcodify_search_button" class="btn rgs_btn-default" value="검색" style="margin: 0 15px 0 0; width: 80px;">
					<input type="text" name="address" class="postcodify_address form-control" value="" size="50"/><br />
                  </td>
               </tr>
               <tr>
                  <th><label class="hostPage_label">오시는 길</	label></th>
                  <td><textarea id="directions" name="directions" class="form-control col-sm-5" rows="10" cols="63" maxlength="100" placeholder="예)
[강남역에서 오시는 방법]
강남역 10번 출구로 나와 신논현역 방향으로 직진
올리브영과 지오다노 사이길로 좌회전
100m 직진 후 GS25 편의점, 노랑통닭(같은 건물) 지나서 좌회전
좌회전 하자마자 커피숍 가기전 (걸어서 5m) 왼편에 건물입구로 들어와 엘레베이터 타고 5층 508호"></textarea></td>
               </tr>
               <tr>
                  <th><label class="hostPage_label">정산계좌 입력</label></th>
                  <td>
                     <div class="bankTags">
                     	<label class="bank_label">거래은행</label>
	                     <select name="bankName" class="form-control">
	                        <option value="국민">국민</option>
	                        <option value="농협">농협</option>
	                        <option value="기업">기업</option>
	                        <option value="우리">우리</option>
	                        <option value="신한">신한</option>
	                     </select>
                     </div>
                     <div class="bankTags">
	                     <label class="bank_label">계좌번호</label>
	                     <input type="text" name="accountNumber" class="form-control" size="30" style="line-height: 27px;">
                     </div>
                  </td>
               </tr>
            </table>
            <br><br>
            <div class="btn-submitLine">
	            <input type="button" id="cancelGuestHouseBtn" class="btn rgs_btn-default btn-lg" value="취소" onclick="history.back()">
    	        <input type="button" id="regiesterGuestHouseBtn" class="btn rgs_btn-default btn-lg" value="등록신청">
            </div>
            
         </form>
         
         <!-- inputCheck Modal -->
		<div id="inputCheckModal" class="modal">
			
			<!-- Modal content -->
			<div class="modal-content">
				<i class="fa fa-exclamation-circle" style="font-size:48px;color:#de9221;"></i>
				<p id="modalMessage"></p>
				<button id="inputCheckModalClose" class="btn rgs_btn-default btn-modal">확인</button>
			</div>
		</div>
         
         
         <div id="defaultRoomInfo" class="roomInfoDiv" style="display: none;">
            <table>
	         	<input type="hidden" name="roomIndex">
	         	<input type="hidden" name="roomCode" value="0">
	         	<tr class="room_tr">
	         		<th><label>방 사진 (최대 5장) <p>메인이미지를  선택해주세요.</p></label></th>
	         		<td>
	         			<div>
			               <input type="file" name="roomAttach" onchange="handleImgsFilesSelect(event)" multiple style="width: 65%;">
			               <input type="button" class="btn rgs_btn-default" value="파일삭제" onclick="deleteImgs(this)">
			            </div>
			            <div class="imgs_wrap room_imgs_wrap" name="roomsImg"></div>
			            <input type="hidden" name="room_imglength">
			            <input type="hidden" name="mainRoomImage" value="0">
	         		</td>
	         	</tr>
               <tr class="room_tr">
                  <th>이름</th>
                  <td><input type="text" name="roomName" class="form-control"></td>
               </tr>
               <tr class="room_tr">
                  <th>가격</th>
                  <td><input type="text" class="inputNumber form-control" name="charge" placeholder="0" onkeyup="numberFormat(this)"> 원</td>
               </tr>
               <tr class="room_tr">
                  <th>전용</th>
                  <td>
                     <input type="hidden" name="gender" value="N">
                     <label class="checkboxLabel"><input type="radio" value="N" checked="checked" onclick="choiceGender(this)">혼성</label>
                     <label class="checkboxLabel"><input type="radio" value="F" onclick="choiceGender(this)">여성</label>
                     <label class="checkboxLabel"><input type="radio" value="M" onclick="choiceGender(this)">남성</label>
                  </td>
               </tr>
               <tr class="room_tr">
                  <th>수용인원 수</th>
                  <td><input type="text" class="inputNumber form-control" name="capacity" onkeyup="numberFormat(this)" size="5"> 명</td>
               </tr>
               <tr class="room_tr">
                  <th>객실 이용안내</th>
                  <td><textarea name="roomInfo" class="form-control col-sm-5" rows="8" cols="37" placeholder="예)
-개인실
-2인 기준 최대 2인
-싱글침대 2개, 개인침구세트 제공 객실 내 욕실 구비 [인원추가 시 업체 사전 문의 필수]
"></textarea></td>
               </tr>
            </table>
            <input type="button" class="removeRoomBtn btn rgs_btn-default" value="삭제" onclick="removeRoom(this)">
         </div>
      </div>
      
      <div layout:fragment="hostPage_script">
      	<!-- <script type="text/javascript">
			 var oEditors = [];
			 nhn.husky.EZCreator.createInIFrame({
			 oAppRef: oEditors,
			 elPlaceHolder: "guestHouseInfo", //textarea에서 지정한 id와 일치해야 합니다.
			 sSkinURI: "/smarteditor/SmartEditor2Skin.html",
			 fCreator: "createSEditor2"
			 });
			
			 var oEditors = [];
			 nhn.husky.EZCreator.createInIFrame({
			 oAppRef: oEditors,
			 elPlaceHolder: "rules", //textarea에서 지정한 id와 일치해야 합니다.
			 sSkinURI: "/smarteditor/SmartEditor2Skin.html",
			 fCreator: "createSEditor2"
			 });
			 
			 var oEditors = [];
			 nhn.husky.EZCreator.createInIFrame({
			 oAppRef: oEditors,
			 elPlaceHolder: "parkingInfo", //textarea에서 지정한 id와 일치해야 합니다.
			 sSkinURI: "/smarteditor/SmartEditor2Skin.html",
			 fCreator: "createSEditor2"
			 });
			 
			 var oEditors = [];
			 nhn.husky.EZCreator.createInIFrame({
			 oAppRef: oEditors,
			 elPlaceHolder: "directions", //textarea에서 지정한 id와 일치해야 합니다.
			 sSkinURI: "/smarteditor/SmartEditor2Skin.html",
			 fCreator: "createSEditor2"
			 });
		</script> -->
		<script type="text/javascript" th:inline="javascript">
            var roomIndex=1;
            $("#addRoomInfoBtn").click(function() {
               var div = document.createElement('div');
               div.setAttribute('class', 'roomInfoDiv');
               
               document.getElementById('roomInfoList').appendChild(div);
               
               var cloneRoom = $('#defaultRoomInfo').children().clone();
               cloneRoom.find('input[name=roomIndex]').val(roomIndex);
               cloneRoom.find('input[type=radio]').attr('name', 'gender'+roomIndex);
               cloneRoom.find('input[name=gender]').attr('id', 'gender'+roomIndex);
               cloneRoom.appendTo(div);
               roomIndex++;
            });
            
            function removeRoom(removeRoomBtn) {
            	$(removeRoomBtn).parent().remove();
            }
            
            function choiceGender(obj) {
               var genderName = obj.name;
               $('#'+genderName).val(obj.value);
            }
            
            //게스트하우스 등록완료
            $("#regiesterGuestHouseBtn").click(function() {
            	if(checkValue()) {
            		console.log("true");
            		$("#registerGuestHouseForm").submit();
            	}
            })
            
            
           	function checkValue() {
            	console.log("checkValue");
            	
            	if(!($("input:checkbox[id='tag']").is(":checked")) || !($("input:checkbox[name='facilityCode']").is(":checked"))) { //체크란 체크여부
            		$("#modalMessage").text("체크란을 체크해주세요!");
            		$("#inputCheckModal").css("display", "block");
            		return false;
            	} else if($(".guestHouse_table").find('.roomInfoDiv').length == 0) { //방 등록 여부
            		$("#modalMessage").text("방 등록은 1개 이상이어야합니다.");
            		$("#inputCheckModal").css("display", "block");
            		return false;
            	}
            	
            	//파일 업로드 여부
            	var fileTags = $(".guestHouse_table").find("input[type=file]");
            	for(var i=0; i<fileTags.length; i++) { 
            		if(!fileTags[i].value) {
            			$("#modalMessage").text("파일 업로드를 해주세요!");
                		$("#inputCheckModal").css("display", "block");
                		return false;
            		} 
            	}
            	
            	//textarea 태그 개수
            	var textareaTags =  $(".guestHouse_table").find("textarea");
            	for(var i=0; i<textareaTags.length; i++) {
            		if(!textareaTags[i].value) {
            			$("#modalMessage").text("입력란을 모두 작성해주세요!");
                		$("#inputCheckModal").css("display", "block");
                		return false;
            		}
            	}
            	
            	var inputTextTag = $(".guestHouse_table").find("input[type=text]");
            	for(var i=0; i<inputTextTag.length; i++) {
            		if(!inputTextTag[i].value) {
            			$("#modalMessage").text("입력란을 모두 작성해주세요!");
                		$("#inputCheckModal").css("display", "block");
                		return false;
            		}
            	}
            	

            	//숫자 받는 입력란 콤마 제거
            	var inputNumberTag = $(".guestHouse_table").find(".inputNumber");
            	for(var i=0; i<inputNumberTag.length; i++) {
            		var x = inputNumberTag[i].value;
            		inputNumberTag[i].value = removeCommas(x);
            	}
            	
            	inputTextArea();
            	
            	return true;
            }
            
            function numberFormat(obj) {
            	$(obj).val(addCommas($(obj).val().replace(/[^0-9]/g,"")));
            }
            
           //3자리 단위마다 콤마 생성
            function addCommas(x) {
                return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }
             
            //모든 콤마 제거
            function removeCommas(x) {
                if(!x || x.length == 0) return "";
                else return x.split(",").join("");
            }
            
            //textArea br태그 넣기
            function inputTextArea() {
            	var textareaTags =  $(".guestHouse_table").find("textarea");
            	for(var i=0; i<textareaTags.length; i++) {
            		var str = textareaTags[i].value;
        			str = str.replace(/(?:\r\n|\r|\n)/g, '<br/>');
        			textareaTags[i].value=str;
            	}
            }
            
            
            $("#inputCheckModalClose").click(function() {
            	$("#inputCheckModal").css("display", "none");
            })
            
            //파일업로드
            var sel_files = [];
            
            $(document).ready(function() {
               $('#input_imgs').on("change", handleImgsFilesSelect);
            });
            
            function handleImgsFilesSelect(e) {
               //이미지 정보들을 초기화
               sel_files = [];
               var prtDiv = e.target.parentNode.nextElementSibling; // div imgs_wrap
               var roomInfoTable = $(prtDiv).parent().parent().parent().parent();
               
               $(prtDiv).empty();
               
               var files = e.target.files;
               var filesArr = Array.prototype.slice.call(files);
               
               
               if(e.target.name == "roomAttach") {
            	   if(2 > files.length || files.length > 5) {
            		   alert("방 이미지는 2장~5장까지만 등록하실 수 있습니다.");
                       $(e.target).val("");
            		   return;
            	   }
               } else {
            	   if(4 > files.length || files.length > 10) {
            		   alert("게스트하우스 이미지는 4장~10장까지만 등록하실 수 있습니다.");
            		   $(e.target).val("");
            		   return;
            	   }
               }
               
               var index = 0;
               filesArr.forEach(function(f) {
                  if(!f.type.match("image.*")) {
                     alert("확장자는 이미지 확장자만 가능합니다.");
                     return;
                  }
                  
                  sel_files.push(f);
                  
                  var reader = new FileReader();
                  reader.onload = function(e) {
                     
                     if($(prtDiv).attr("name")=='roomsImg') { //방일 경우
                        var html = 
                           "<span class='thumbnailImgSpan'><input type='radio' name='mainRoomImage"+$(roomInfoTable).find("input[name='roomIndex']").val()+"' value='"+index
                           +"' onclick='clickMainRoomImg($(this).parent().parent().next().next(), this.value)'"+(index==0?'checked=checked':'')+"><img src=\""+e.target.result+"\" data-file='"+f.name
                           +"' class='selProductFile' title='Click to remove'></span>";
                     } else { //게스트하우스일 경우
                        var html = "<span class='thumbnailImgSpan'><input type='radio' name='mainImage' value='"+index+"' "+(index==0?'checked=checked':'')+"><img src=\""+e.target.result+"\" data-file='"+f.name
                        +"' class='selProductFile' title='Click to remove'></span>";
                     }
                     $(prtDiv).append(html);
                     index++;
                     $(prtDiv).next('input[type=hidden]').val(index);
                  }
                  reader.readAsDataURL(f);
               });
            }
            
            function deleteImgs(obj) {
                var input_imgs = obj.previousElementSibling;
               $(input_imgs).val("");
               var brtDiv = obj.parentNode.nextElementSibling;
               $(brtDiv).children().remove();
            }
            
            function clickMainRoomImg(obj, chkValue) {
               $(obj).val(chkValue);
            }
           
            
         </script>
         
         <!-- 주소 api 적용 -->
         <!-- Postcodify를 로딩한다 -->
		 <script src="//d1p7wdleee1q2z.cloudfront.net/post/search.min.js"></script>
		 <!-- "검색" 단추를 누르면 팝업 레이어가 열리도록 설정한다 -->
		 <script> $(function() { $("#postcodify_search_button").postcodifyPopUp(); }); </script>
      </div>
   </body>
</html>